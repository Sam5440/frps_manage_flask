<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRPC Config Editor</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .tcp {
            background-color: blue;
            color: white;
        }
        .udp {
            background-color: orange;
            color: white;
        }
        .all {
            background-color: yellow;
            color: black;
        }
    </style>
    <script>
        function toggleEdit(section) {
            var form = document.getElementById(section + '-form');
            var inputs = form.querySelectorAll('input[type="text"]');
            var saveButton = form.querySelector('input[type="submit"][value="Save"]');
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].disabled = !inputs[i].disabled;
            }
            saveButton.disabled = !saveButton.disabled;
        }
    </script>
</head>
<body>
    <h1>FRPC Config Editor</h1>
    
    <!-- Display common section separately -->
    <h2>Common Section</h2>
    <table>
        <thead>
            <tr>
                <th>Option</th>
                <th>Value</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <form id="common-form" action="{{ url_for('update', section='common') }}" method="post">
                {% for option in config['common'] %}
                    <tr>
                        <td>{{ option }}</td>
                        <td><input type="text" name="{{ option }}" value="{{ config['common'][option] }}" disabled></td>
                        {% if loop.first %}
                            <td rowspan="{{ config['common']|length }}">
                                <input type="button" value="Edit" onclick="toggleEdit('common')">
                                <input type="submit" value="Save" disabled>
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </form>
            <tr>
                <td colspan="3">
                    <form action="{{ url_for('add_option', section='common') }}" method="post">
                        <input type="text" name="new_option" placeholder="New Option">
                        <input type="submit" value="Add Option">
                    </form>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Display other sections as Excel-like table -->
    <h2>Other Sections</h2>
    <table>
        <thead>
            <tr>
                <th>Section</th>
                <th>Type</th>
                <th>Local IP</th>
                <th>Local Port</th>
                <th>Remote Port</th>
                <th>Custom Domains</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for section in config.sections() %}
                {% if section != 'common' %}
                    <tr id="{{ section }}-form">
                        <form action="{{ url_for('update', section=section) }}" method="post">
                            <td><input type="text" name="new_section" value="{{ section }}" disabled></td>
                            <td class="{{ config[section].get('type', '') }}"><input type="text" name="type" value="{{ config[section].get('type', '') }}" disabled></td>
                            <td><input type="text" name="local_ip" value="{{ config[section].get('local_ip', '') }}" disabled></td>
                            <td><input type="text" name="local_port" value="{{ config[section].get('local_port', '') }}" disabled></td>
                            <td><input type="text" name="remote_port" value="{{ config[section].get('remote_port', '') }}" disabled></td>
                            <td><input type="text" name="custom_domains" value="{{ config[section].get('custom_domains', '') }}" disabled></td>
                            <td>
                                <input type="button" value="Edit" onclick="toggleEdit('{{ section }}')">
                                <input type="submit" value="Save" disabled>
                            </td>
                        </form>
                        <td>
                            <form action="{{ url_for('delete', section=section) }}" method="post">
                                <input type="submit" value="Delete Section">
                            </form>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
            <tr>
                <td colspan="7">
                    <form action="{{ url_for('add') }}" method="post">
                        <input type="text" name="new_section" placeholder="New Section Name">
                        <input type="submit" value="Add Section">
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>